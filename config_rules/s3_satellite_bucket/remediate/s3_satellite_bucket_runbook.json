{
    "description": "Automation Document for s3 satellite bucket remediation",
    "assumeRole": "{{ AutomationAssumeRole }}",
    "schemaVersion": "0.3",
    "parameters": {
        "AutomationAssumeRole": {
            "description": "The ARN of the role that allows Automation to perform the actions on your behalf.",
            "type": "String"
        },
        "awsRegion": {
            "description": "AWS region to restrict the S3 satellite account bucket content to.",
            "default": "ca-central-1",
            "type": "String"
        },
        "kmsKeyId": {
            "description": "KMS key ID used to encrypt objects during replication to the logArchiveBucket",
            "type": "String"
        },
        "logArchiveAccount": {
            "description": "AWS account ID that contains the log archive bucket.",
            "default": "339850311124",
            "type": "String"
        },
        "logArchiveBucket": {
            "description": "Name of the S3 log archive bucket to replicate logs to.",
            "default": "cbs-log-archive-339850311124",
            "type": "String"
        },
        "replicationRoleArn": {
            "description": "Role ARN used to perform the s3 object replication.",
            "type": "String"
        },
        "slackWebhook": {
            "description": "Slack webhook URL to post failure messages to.",
            "type": "String"
        }
    },
    "mainSteps": [
        {
            "maxAttempts": 3,
            "inputs": {
                "FunctionName": "CbsS3SatelliteBucketRemediate",
                "Payload": "{\"awsRegion\":\"{{ awsRegion }}\",\"kmsKeyId\":\"{{ kmsKeyId }}\",\"logArchiveAccount\":\"{{ logArchiveAccount }}\",\"logArchiveBucket\":\"{{ logArchiveBucket }}\",\"replicationRoleArn\":\"{{ replicationRoleArn }}\",\"slackWebhook\":\"{{ slackWebhook }}\"}"
            },
            "name": "invokeRemediateLambdaFunction",
            "action": "aws:invokeLambdaFunction",
            "timeoutSeconds": 120,
            "onFailure": "Abort"
        }
    ]
}