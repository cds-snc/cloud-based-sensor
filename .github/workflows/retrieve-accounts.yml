name: "Retrieve accounts"

# Retrieves the satellite account IDs in a structure that can be used
# by a GitHub workflow matrix

on:
  workflow_call:
    outputs:
      matrix:
        description: "The matrix of satellite accounts"
        value: ${{ jobs.retrieve-accounts.outputs.matrix }}

jobs:
  retrieve-accounts:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
    steps:
      - name: Checkout
        uses: actions/checkout@f43a0e5ff2bd294095638e18286ca9a3d1956744 # v3.6.0

      - name: Read account file
        id: set-matrix
        run: |
          accounts=$(jq -n -c "{\"include\": [inputs | {"account": .} ] }"  satellite_accounts)
          echo "matrix=$accounts" >> "$GITHUB_OUTPUT"
