name: "Retrieve accounts"

# Retrieves the satellite account IDs in a structure that can be used
# by a GitHub workflow matrix

on:
  workflow_call:
    outputs:
      matrix:
        description: "The matrix of satellite accounts"
        value: ${{ jobs.retrieve-accounts.outputs.matrix }}

jobs:
  retrieve-accounts:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
    steps:
      - name: Checkout
        uses: actions/checkout@8f4b7f84864484a7bf31766abe9204da3cbe65b3 # v3.5.0

      - name: Read account file
        id: set-matrix
        run: |
          accounts=$(jq -n -c "{\"include\": [inputs | {"account": .} ] }"  satellite_accounts)
          echo "::set-output name=matrix::$accounts"
